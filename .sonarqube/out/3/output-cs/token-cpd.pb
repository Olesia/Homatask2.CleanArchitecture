Ù
âC:\Users\Olesia_Skrypchenko\source\repos\Mentoring program 2022\Homatask3.WebApiCleanArchitecture\src\Infrastructure\ConfigureServices.cs
	namespace 	
	Microsoft
 
. 

Extensions 
. 
DependencyInjection 2
;2 3
public 
static 
class 
ConfigureServices %
{ 
public 

static 
IServiceCollection $%
AddInfrastructureServices% >
(> ?
this? C
IServiceCollectionD V
servicesW _
,_ `
IConfigurationa o
configurationp }
)} ~
{ 
if 

( 
configuration 
. 
GetValue "
<" #
bool# '
>' (
(( )
$str) >
)> ?
)? @
{ 	
services 
. 
AddDbContext !
<! " 
ApplicationDbContext" 6
>6 7
(7 8
options8 ?
=>@ B
options 
. 
UseInMemoryDatabase +
(+ ,
$str, K
)K L
)L M
;M N
} 	
else 
{ 	
services 
. 
AddDbContext !
<! " 
ApplicationDbContext" 6
>6 7
(7 8
options8 ?
=>@ B
options 
. 
UseSqlServer $
($ %
configuration% 2
.2 3
GetConnectionString3 F
(F G
$strG Z
)Z [
,[ \
builder 
=> 
builder &
.& '
MigrationsAssembly' 9
(9 :
typeof: @
(@ A 
ApplicationDbContextA U
)U V
.V W
AssemblyW _
._ `
FullName` h
)h i
)i j
)j k
;k l
} 	
services   
.   
	AddScoped   
<   !
IApplicationDbContext   0
>  0 1
(  1 2
provider  2 :
=>  ; =
provider  > F
.  F G
GetRequiredService  G Y
<  Y Z 
ApplicationDbContext  Z n
>  n o
(  o p
)  p q
)  q r
;  r s
services"" 
."" 
	AddScoped"" 
<"" +
ApplicationDbContextInitialiser"" :
>"": ;
(""; <
)""< =
;""= >
services$$ 
.$$ 
	AddScoped$$ 
<$$ 
IRepository$$ &
<$$& '
Item$$' +
>$$+ ,
,$$, -
ItemRepository$$. <
>$$< =
($$= >
)$$> ?
;$$? @
services%% 
.%% 
	AddScoped%% 
<%% 
IRepository%% &
<%%& '
Category%%' /
>%%/ 0
,%%0 1
CategoryRepository%%2 D
>%%D E
(%%E F
)%%F G
;%%G H
services&& 
.&& 
	AddScoped&& 
<&& 
IMessagePublisher&& ,
,&&, -
MessagePublisher&&. >
>&&> ?
(&&? @
)&&@ A
;&&A B
services'' 
.'' 
AddSingleton'' 
('' 
('' 
s''  
)''  !
=>''" $
{(( 	
return)) 
new)) 
ServiceBusClient)) '
())' (
configuration))( 5
.))5 6
GetConnectionString))6 I
())I J
$str))J [
)))[ \
,))\ ]
new))^ a#
ServiceBusClientOptions))b y
())y z
)))z {
{))| }
TransportType	))~ ã
=
))å ç%
ServiceBusTransportType
))é •
.
))• ¶
AmqpWebSockets
))¶ ¥
}
))µ ∂
)
))∂ ∑
;
))∑ ∏
}** 	
)**	 

;**
 
return,, 
services,, 
;,, 
}-- 
}.. ù
òC:\Users\Olesia_Skrypchenko\source\repos\Mentoring program 2022\Homatask3.WebApiCleanArchitecture\src\Infrastructure\Persistence\ApplicationDbContext.cs
	namespace

 	
	Homatask2


 
.

 
CleanArchitecture

 %
.

% &
Infrastructure

& 4
.

4 5
Persistence

5 @
;

@ A
public 
class  
ApplicationDbContext !
:" #
	DbContext$ -
,- .!
IApplicationDbContext/ D
{ 
private 
readonly 
	IMediator 
	_mediator (
;( )
public 
 
ApplicationDbContext 
(  
	IMediator 
mediator 
, 
DbContextOptions 
<  
ApplicationDbContext -
>- .
options/ 6
)6 7
: 	
base
 
( 
options 
) 
{ 
	_mediator 
= 
mediator 
; 
} 
public 

DbSet 
< 
Category 
> 

Categories %
=>& (
Set) ,
<, -
Category- 5
>5 6
(6 7
)7 8
;8 9
public 

DbSet 
< 
Item 
> 
Items 
=> 
Set  #
<# $
Item$ (
>( )
() *
)* +
;+ ,
	protected 
override 
void 
OnModelCreating +
(+ ,
ModelBuilder, 8
builder9 @
)@ A
{ 
builder 
. 
Entity 
< 
Category 
>  
(  !
)! "
. 
HasOne 
( 
v 
=> 
v 
. 
ParentCategory )
)) *
.   
WithOne   
(   
)   
.!! 
HasForeignKey!! 
<!! 
Category!! #
>!!# $
(!!$ %
c!!% &
=>!!' )
c!!* +
.!!+ ,
ParentCategoryId!!, <
)!!< =
."" 
OnDelete"" 
("" 
DeleteBehavior"" $
.""$ %
ClientCascade""% 2
)""2 3
;""3 4
base$$ 
.$$ 
OnModelCreating$$ 
($$ 
builder$$ $
)$$$ %
;$$% &
}%% 
public'' 

override'' 
async'' 
Task'' 
<'' 
int'' "
>''" #
SaveChangesAsync''$ 4
(''4 5
CancellationToken''5 F
cancellationToken''G X
=''Y Z
default''[ b
)''b c
{(( 
return)) 
await)) 
base)) 
.)) 
SaveChangesAsync)) *
())* +
cancellationToken))+ <
)))< =
;))= >
}** 
}++ ëR
£C:\Users\Olesia_Skrypchenko\source\repos\Mentoring program 2022\Homatask3.WebApiCleanArchitecture\src\Infrastructure\Persistence\ApplicationDbContextInitialiser.cs
	namespace 	
	Homatask2
 
. 
CleanArchitecture %
.% &
Infrastructure& 4
.4 5
Persistence5 @
;@ A
public 
class +
ApplicationDbContextInitialiser ,
{ 
private		 
readonly		  
ApplicationDbContext		 )
_context		* 2
;		2 3
public 
+
ApplicationDbContextInitialiser *
(* + 
ApplicationDbContext+ ?
context@ G
)G H
{ 
_context 
= 
context 
; 
} 
public 

async 
Task 
InitialiseAsync %
(% &
)& '
{ 
if 

( 
_context 
. 
Database 
. 
IsSqlServer )
() *
)* +
)+ ,
{ 	
await 
_context 
. 
Database #
.# $
MigrateAsync$ 0
(0 1
)1 2
;2 3
} 	
} 
public 

async 
Task 
	SeedAsync 
(  
)  !
{ 
if 

( 
! 
_context 
. 

Categories  
.  !
Any! $
($ %
)% &
)& '
{ 	
_context 
. 

Categories 
.  
Add  #
(# $
new$ '
Category( 0
{1 2
Name3 7
=8 9
$str: F
}G H
)H I
;I J
_context 
. 

Categories 
.  
Add  #
(# $
new$ '
Category( 0
{1 2
Name3 7
=8 9
$str: F
}G H
)H I
;I J
_context 
. 

Categories 
.  
Add  #
(# $
new$ '
Category( 0
{1 2
Name3 7
=8 9
$str: F
}G H
)H I
;I J
await 
_context 
. 
SaveChangesAsync +
(+ ,
), -
;- .
}   	
if"" 

("" 
!"" 
_context"" 
."" 
Items"" 
."" 
Any"" 
(""  
)""  !
)""! "
{## 	
var$$ 

categoryId$$ 
=$$ 
_context$$ %
.$$% &

Categories$$& 0
.$$0 1
Where$$1 6
($$6 7
c$$7 8
=>$$9 ;
c$$< =
.$$= >
Name$$> B
==$$C E
$str$$F R
)$$R S
.$$S T
FirstOrDefault$$T b
($$b c
)$$c d
?$$d e
.$$e f
Id$$f h
;$$h i
if%% 
(%% 

categoryId%% 
!=%% 
null%% "
)%%" #
{&& 
_context'' 
.'' 
Items'' 
.'' 
Add'' "
(''" #
new''# &
Item''' +
{'', -
Name''. 2
=''3 4
$str''5 =
,''= >
Description''? J
=''K L
$str''M \
,''\ ]
Price''^ c
=''d e
$num''f i
,''i j
Amount''k q
=''r s
$num''t u
,''u v

CategoryId	''w Å
=
''Ç É

categoryId
''Ñ é
.
''é è
Value
''è î
}
''ï ñ
)
''ñ ó
;
''ó ò
_context(( 
.(( 
Items(( 
.(( 
Add(( "
(((" #
new((# &
Item((' +
{((, -
Name((. 2
=((3 4
$str((5 =
,((= >
Description((? J
=((K L
$str((M \
,((\ ]
Price((^ c
=((d e
$num((f i
,((i j
Amount((k q
=((r s
$num((t v
,((v w

CategoryId	((x Ç
=
((É Ñ

categoryId
((Ö è
.
((è ê
Value
((ê ï
}
((ñ ó
)
((ó ò
;
((ò ô
_context)) 
.)) 
Items)) 
.)) 
Add)) "
())" #
new))# &
Item))' +
{)), -
Name)). 2
=))3 4
$str))5 =
,))= >
Description))? J
=))K L
$str))M \
,))\ ]
Price))^ c
=))d e
$num))f j
,))j k
Amount))l r
=))s t
$num))u w
,))w x

CategoryId	))y É
=
))Ñ Ö

categoryId
))Ü ê
.
))ê ë
Value
))ë ñ
}
))ó ò
)
))ò ô
;
))ô ö
_context** 
.** 
Items** 
.** 
Add** "
(**" #
new**# &
Item**' +
{**, -
Name**. 2
=**3 4
$str**5 =
,**= >
Description**? J
=**K L
$str**M \
,**\ ]
Price**^ c
=**d e
$num**f i
,**i j
Amount**k q
=**r s
$num**t u
,**u v

CategoryId	**w Å
=
**Ç É

categoryId
**Ñ é
.
**é è
Value
**è î
}
**ï ñ
)
**ñ ó
;
**ó ò
_context++ 
.++ 
Items++ 
.++ 
Add++ "
(++" #
new++# &
Item++' +
{++, -
Name++. 2
=++3 4
$str++5 =
,++= >
Description++? J
=++K L
$str++M \
,++\ ]
Price++^ c
=++d e
$num++f i
,++i j
Amount++k q
=++r s
$num++t v
,++v w

CategoryId	++x Ç
=
++É Ñ

categoryId
++Ö è
.
++è ê
Value
++ê ï
}
++ñ ó
)
++ó ò
;
++ò ô
_context,, 
.,, 
Items,, 
.,, 
Add,, "
(,," #
new,,# &
Item,,' +
{,,, -
Name,,. 2
=,,3 4
$str,,5 =
,,,= >
Description,,? J
=,,K L
$str,,M \
,,,\ ]
Price,,^ c
=,,d e
$num,,f j
,,,j k
Amount,,l r
=,,s t
$num,,u w
,,,w x

CategoryId	,,y É
=
,,Ñ Ö

categoryId
,,Ü ê
.
,,ê ë
Value
,,ë ñ
}
,,ó ò
)
,,ò ô
;
,,ô ö
_context-- 
.-- 
Items-- 
.-- 
Add-- "
(--" #
new--# &
Item--' +
{--, -
Name--. 2
=--3 4
$str--5 =
,--= >
Description--? J
=--K L
$str--M \
,--\ ]
Price--^ c
=--d e
$num--f i
,--i j
Amount--k q
=--r s
$num--t u
,--u v

CategoryId	--w Å
=
--Ç É

categoryId
--Ñ é
.
--é è
Value
--è î
}
--ï ñ
)
--ñ ó
;
--ó ò
_context.. 
... 
Items.. 
... 
Add.. "
(.." #
new..# &
Item..' +
{.., -
Name... 2
=..3 4
$str..5 =
,..= >
Description..? J
=..K L
$str..M \
,..\ ]
Price..^ c
=..d e
$num..f i
,..i j
Amount..k q
=..r s
$num..t v
,..v w

CategoryId	..x Ç
=
..É Ñ

categoryId
..Ö è
.
..è ê
Value
..ê ï
}
..ñ ó
)
..ó ò
;
..ò ô
_context// 
.// 
Items// 
.// 
Add// "
(//" #
new//# &
Item//' +
{//, -
Name//. 2
=//3 4
$str//5 =
,//= >
Description//? J
=//K L
$str//M \
,//\ ]
Price//^ c
=//d e
$num//f j
,//j k
Amount//l r
=//s t
$num//u w
,//w x

CategoryId	//y É
=
//Ñ Ö

categoryId
//Ü ê
.
//ê ë
Value
//ë ñ
}
//ó ò
)
//ò ô
;
//ô ö
_context00 
.00 
Items00 
.00 
Add00 "
(00" #
new00# &
Item00' +
{00, -
Name00. 2
=003 4
$str005 =
,00= >
Description00? J
=00K L
$str00M ]
,00] ^
Price00_ d
=00e f
$num00g j
,00j k
Amount00l r
=00s t
$num00u v
,00v w

CategoryId	00x Ç
=
00É Ñ

categoryId
00Ö è
.
00è ê
Value
00ê ï
}
00ñ ó
)
00ó ò
;
00ò ô
_context11 
.11 
Items11 
.11 
Add11 "
(11" #
new11# &
Item11' +
{11, -
Name11. 2
=113 4
$str115 =
,11= >
Description11? J
=11K L
$str11M ]
,11] ^
Price11_ d
=11e f
$num11g j
,11j k
Amount11l r
=11s t
$num11u w
,11w x

CategoryId	11y É
=
11Ñ Ö

categoryId
11Ü ê
.
11ê ë
Value
11ë ñ
}
11ó ò
)
11ò ô
;
11ô ö
_context22 
.22 
Items22 
.22 
Add22 "
(22" #
new22# &
Item22' +
{22, -
Name22. 2
=223 4
$str225 =
,22= >
Description22? J
=22K L
$str22M ]
,22] ^
Price22_ d
=22e f
$num22g k
,22k l
Amount22m s
=22t u
$num22v x
,22x y

CategoryId	22z Ñ
=
22Ö Ü

categoryId
22á ë
.
22ë í
Value
22í ó
}
22ò ô
)
22ô ö
;
22ö õ
}33 
await44 
_context44 
.44 
SaveChangesAsync44 +
(44+ ,
)44, -
;44- .
}55 	
}66 
}77 í	
®C:\Users\Olesia_Skrypchenko\source\repos\Mentoring program 2022\Homatask3.WebApiCleanArchitecture\src\Infrastructure\Persistence\Configurations\CategoryConfiguration.cs
	namespace 	
	Homatask2
 
. 
CleanArchitecture %
.% &
Infrastructure& 4
.4 5
Persistence5 @
.@ A
ConfigurationsA O
;O P
public 
class !
CategoryConfiguration "
:# $$
IEntityTypeConfiguration% =
<= >
Category> F
>F G
{		 
public

 

void

 
	Configure

 
(

 
EntityTypeBuilder

 +
<

+ ,
Category

, 4
>

4 5
builder

6 =
)

= >
{ 
builder 
. 
Property 
( 
t 
=> 
t 
.  
Name  $
)$ %
. 

IsRequired 
( 
) 
. 
HasMaxLength 
( 
$num 
) 
; 
} 
} ˙
§C:\Users\Olesia_Skrypchenko\source\repos\Mentoring program 2022\Homatask3.WebApiCleanArchitecture\src\Infrastructure\Persistence\Configurations\ItemConfiguration.cs
	namespace 	
	Homatask2
 
. 
CleanArchitecture %
.% &
Infrastructure& 4
.4 5
Persistence5 @
.@ A
ConfigurationsA O
;O P
public 
class 
ItemConfiguration 
:  $
IEntityTypeConfiguration! 9
<9 :
Item: >
>> ?
{		 
public

 

void

 
	Configure

 
(

 
EntityTypeBuilder

 +
<

+ ,
Item

, 0
>

0 1
builder

2 9
)

9 :
{ 
builder 
. 
Property 
( 
p 
=> 
p 
.  
Name  $
)$ %
. 

IsRequired 
( 
) 
. 
HasMaxLength 
( 
$num 
) 
; 
builder 
. 
Property 
( 
p 
=> 
p 
.  
Category  (
)( )
. 

IsRequired 
( 
) 
; 
builder 
. 
Property 
( 
p 
=> 
p 
.  
Price  %
)% &
. 

IsRequired 
( 
) 
; 
builder 
. 
Property 
( 
p 
=> 
p 
.  
Amount  &
)& '
. 

IsRequired 
( 
) 
; 
} 
} í>
´C:\Users\Olesia_Skrypchenko\source\repos\Mentoring program 2022\Homatask3.WebApiCleanArchitecture\src\Infrastructure\Persistence\Migrations\20220704235235_InitialCreate.cs
	namespace 	
	Homatask2
 
. 
CleanArchitecture %
.% &
Infrastructure& 4
.4 5

Migrations5 ?
;? @
public 
partial 
class 
InitialCreate "
:# $
	Migration% .
{ 
	protected		 
override		 
void		 
Up		 
(		 
MigrationBuilder		 /
migrationBuilder		0 @
)		@ A
{

 
migrationBuilder 
. 
CreateTable $
($ %
name 
: 
$str 
, 
columns 
: 
table 
=> 
new !
{ 
Id 
= 
table 
. 
Column !
<! "
int" %
>% &
(& '
type' +
:+ ,
$str- 2
,2 3
nullable4 <
:< =
false> C
)C D
. 

Annotation 
(  
$str  4
,4 5
$str6 <
)< =
,= >
Name 
= 
table 
. 
Column #
<# $
string$ *
>* +
(+ ,
type, 0
:0 1
$str2 @
,@ A
	maxLengthB K
:K L
$numM O
,O P
nullableQ Y
:Y Z
false[ `
)` a
,a b
Image 
= 
table 
. 
Column $
<$ %
string% +
>+ ,
(, -
type- 1
:1 2
$str3 B
,B C
nullableD L
:L M
trueN R
)R S
,S T
ParentCategoryId  
=! "
table# (
.( )
Column) /
</ 0
int0 3
>3 4
(4 5
type5 9
:9 :
$str; @
,@ A
nullableB J
:J K
trueL P
)P Q
} 
, 
constraints 
: 
table 
=> !
{ 
table 
. 

PrimaryKey  
(  !
$str! 0
,0 1
x2 3
=>4 6
x7 8
.8 9
Id9 ;
); <
;< =
table 
. 

ForeignKey  
(  !
name 
: 
$str E
,E F
column 
: 
x 
=>  
x! "
." #
ParentCategoryId# 3
,3 4
principalTable "
:" #
$str$ 0
,0 1
principalColumn #
:# $
$str% )
)) *
;* +
} 
) 
; 
migrationBuilder 
. 
CreateTable $
($ %
name   
:   
$str   
,   
columns!! 
:!! 
table!! 
=>!! 
new!! !
{"" 
Id## 
=## 
table## 
.## 
Column## !
<##! "
int##" %
>##% &
(##& '
type##' +
:##+ ,
$str##- 2
,##2 3
nullable##4 <
:##< =
false##> C
)##C D
.$$ 

Annotation$$ 
($$  
$str$$  4
,$$4 5
$str$$6 <
)$$< =
,$$= >
Name%% 
=%% 
table%% 
.%% 
Column%% #
<%%# $
string%%$ *
>%%* +
(%%+ ,
type%%, 0
:%%0 1
$str%%2 @
,%%@ A
	maxLength%%B K
:%%K L
$num%%M O
,%%O P
nullable%%Q Y
:%%Y Z
false%%[ `
)%%` a
,%%a b
Description&& 
=&& 
table&& #
.&&# $
Column&&$ *
<&&* +
string&&+ 1
>&&1 2
(&&2 3
type&&3 7
:&&7 8
$str&&9 H
,&&H I
nullable&&J R
:&&R S
true&&T X
)&&X Y
,&&Y Z
Image'' 
='' 
table'' 
.'' 
Column'' $
<''$ %
string''% +
>''+ ,
('', -
type''- 1
:''1 2
$str''3 B
,''B C
nullable''D L
:''L M
true''N R
)''R S
,''S T
Price(( 
=(( 
table(( 
.(( 
Column(( $
<(($ %
decimal((% ,
>((, -
(((- .
type((. 2
:((2 3
$str((4 C
,((C D
nullable((E M
:((M N
false((O T
)((T U
,((U V
Amount)) 
=)) 
table)) 
.)) 
Column)) %
<))% &
long))& *
>))* +
())+ ,
type)), 0
:))0 1
$str))2 :
,)): ;
nullable))< D
:))D E
false))F K
)))K L
,))L M

CategoryId** 
=** 
table** "
.**" #
Column**# )
<**) *
int*** -
>**- .
(**. /
type**/ 3
:**3 4
$str**5 :
,**: ;
nullable**< D
:**D E
false**F K
)**K L
}++ 
,++ 
constraints,, 
:,, 
table,, 
=>,, !
{-- 
table.. 
... 

PrimaryKey..  
(..  !
$str..! +
,..+ ,
x..- .
=>../ 1
x..2 3
...3 4
Id..4 6
)..6 7
;..7 8
table// 
.// 

ForeignKey//  
(//  !
name00 
:00 
$str00 :
,00: ;
column11 
:11 
x11 
=>11  
x11! "
.11" #

CategoryId11# -
,11- .
principalTable22 "
:22" #
$str22$ 0
,220 1
principalColumn33 #
:33# $
$str33% )
,33) *
onDelete44 
:44 
ReferentialAction44 /
.44/ 0
Cascade440 7
)447 8
;448 9
}55 
)55 
;55 
migrationBuilder77 
.77 
CreateIndex77 $
(77$ %
name88 
:88 
$str88 2
,882 3
table99 
:99 
$str99 
,99  
column:: 
::: 
$str:: &
,::& '
unique;; 
:;; 
true;; 
,;; 
filter<< 
:<< 
$str<< 4
)<<4 5
;<<5 6
migrationBuilder>> 
.>> 
CreateIndex>> $
(>>$ %
name?? 
:?? 
$str?? '
,??' (
table@@ 
:@@ 
$str@@ 
,@@ 
columnAA 
:AA 
$strAA  
)AA  !
;AA! "
}BB 
	protectedDD 
overrideDD 
voidDD 
DownDD  
(DD  !
MigrationBuilderDD! 1
migrationBuilderDD2 B
)DDB C
{EE 
migrationBuilderFF 
.FF 
	DropTableFF "
(FF" #
nameGG 
:GG 
$strGG 
)GG 
;GG 
migrationBuilderII 
.II 
	DropTableII "
(II" #
nameJJ 
:JJ 
$strJJ 
)JJ 
;JJ  
}KK 
}LL 